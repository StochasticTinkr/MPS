package jetbrains.mps.ide.editor.util;

/*Generated by MPS */

import jetbrains.mps.project.MPSProject;
import jetbrains.mps.ide.findusages.model.SearchQuery;
import java.util.List;
import jetbrains.mps.ide.findusages.findalgorithm.finders.Finder;
import jetbrains.mps.ide.editor.util.renderer.BaseRenderer;
import jetbrains.mps.ide.navigation.NodeNavigatable;
import com.intellij.ui.awt.RelativePoint;
import org.jetbrains.mps.openapi.model.SNodeReference;
import java.util.ArrayList;
import com.intellij.util.Function;
import java.util.Comparator;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.module.SearchScope;
import java.util.Arrays;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.awt.event.InputEvent;
import java.awt.event.MouseEvent;
import jetbrains.mps.nodeEditor.EditorComponent;
import java.awt.Point;

public final class PopupSettingsBuilder {
  /*package*/ final MPSProject myProject;
  /*package*/ SearchQuery query;
  /*package*/ List<Finder> finders;
  /*package*/ CaptionFunction captionFun;
  /*package*/ BaseRenderer<NodeNavigatable> renderer;
  /*package*/ RelativePoint point;
  /*package*/ List<SNodeReference> foundUsages = new ArrayList<SNodeReference>();
  /*package*/ Function<SNodeReference, String> nameFilter;
  /*package*/ Comparator<SNodeReference> comparator;

  public PopupSettingsBuilder(@NotNull MPSProject project) {
    myProject = project;
  }

  public PopupSettingsBuilder query(@NotNull SearchQuery query) {
    this.query = query;
    return this;
  }

  public PopupSettingsBuilder queryFromNode(@NotNull SNode node) {
    return queryFromNode(node, null);
  }

  public PopupSettingsBuilder queryFromNode(@NotNull SNode node, SearchScope scope) {
    this.query = GoToHelper.createNodeQuery(myProject.getRepository(), node, scope);
    return this;
  }

  public PopupSettingsBuilder finders(@NotNull Finder... finders) {
    this.finders = Arrays.asList(finders);
    return this;
  }

  public PopupSettingsBuilder renderer(@NotNull BaseRenderer<NodeNavigatable> renderer) {
    this.renderer = renderer;
    return this;
  }

  public PopupSettingsBuilder captionFun(@NotNull CaptionFunction captionFun) {
    this.captionFun = captionFun;
    return this;
  }

  public PopupSettingsBuilder point(@NotNull RelativePoint point) {
    this.point = point;
    return this;
  }

  public PopupSettingsBuilder pointFromCellAndEvent(EditorCell selectedCell, InputEvent inputEvent) {
    RelativePoint newPoint;
    if (inputEvent instanceof MouseEvent) {
      newPoint = new RelativePoint(((MouseEvent) inputEvent));
    } else {
      newPoint = new RelativePoint((EditorComponent) selectedCell.getEditorComponent(), new Point(selectedCell.getX(), selectedCell.getY()));
    }
    return point(newPoint);
  }

  public PopupSettingsBuilder nameFilter(@NotNull Function<SNodeReference, String> namer) {
    this.nameFilter = namer;
    return this;
  }

  public PopupSettingsBuilder comparator(@NotNull Comparator<SNodeReference> comparator) {
    this.comparator = comparator;
    return this;
  }

  public PopupSettingsBuilder usages(@NotNull List<SNodeReference> foundUsages) {
    this.foundUsages = foundUsages;
    return this;
  }
}

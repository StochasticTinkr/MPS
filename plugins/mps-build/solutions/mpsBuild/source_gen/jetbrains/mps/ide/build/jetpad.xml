<project name="jetpad" default="build" basedir="../">
  <!-- Generated by MPS -->
  <property name="build.dir" location="build" />
  <property name="build.tmp" location="${build.dir}/tmp/jetpad" />
  <property name="build.layout" location="${build.dir}/artifacts/jetpad" />
  <property name="idea_home" location="" />
  <property name="mps_home" location="${basedir}" />
  <property name="artifacts.mpsBootstrapCore" location="${build.dir}/artifacts/mpsBootstrapCore" />
  <property name="artifacts.mpsCore" location="${build.dir}/artifacts/mpsCore" />
  <property name="artifacts.IDEA" location="${idea_home}" />
  <property file="${artifacts.mpsBootstrapCore}/build.properties" prefix="import.mpsBootstrapCore" />
  <property name="mpsBootstrapCore.version" value="${import.mpsBootstrapCore.mpsBootstrapCore.version}" />
  
  <path id="path.mps.ant.path">
    <pathelement location="${artifacts.mpsBootstrapCore}/lib/ant/lib/ant-mps.jar" />
    <pathelement location="${artifacts.IDEA}/lib/jdom.jar" />
    <pathelement location="${artifacts.IDEA}/lib/log4j.jar" />
  </path>
  
  <target name="assemble" depends="classes, declare-mps-tasks">
    <mkdir dir="${build.layout}/jetpad" />
    <mkdir dir="${build.layout}/jetpad/META-INF" />
    <copy todir="${build.layout}/jetpad/META-INF">
      <fileset file="${mps_home}/plugins/jetpad/META-INF/plugin.xml" />
    </copy>
    <mkdir dir="${build.layout}/jetpad/languages" />
    <mkdir dir="${build.layout}/jetpad/languages/jetpad" />
    <mkdir dir="${build.tmp}/default/jetbrains.jetpad.jar" />
    <mkdir dir="${build.tmp}/default/jetbrains.jetpad.jar/META-INF" />
    <echoxml file="${build.tmp}/default/jetbrains.jetpad.jar/META-INF/module.xml">
      <module namespace="jetbrains.jetpad" type="solution" uuid="67b3c41d-58b3-4756-b971-30bf8a9d63e6">
        <dependencies />
        <library jar="../../lib/base-1.0.0-jvm6.jar" />
        <library jar="../../lib/base-projectional-1.0.0-jvm6.jar" />
        <library jar="../../lib/cell-1.0.0-jvm6.jar" />
        <library jar="../../lib/completion-1.0.0-jvm6.jar" />
        <library jar="../../lib/diagram-1.0.0-jvm6.jar" />
        <library jar="../../lib/domUtil-1.0.0-jvm6.jar" />
        <library jar="../../lib/event-1.0.0-jvm6.jar" />
        <library jar="../../lib/geometry-1.0.0-jvm6.jar" />
        <library jar="../../lib/grammar-1.0.0-jvm6.jar" />
        <library jar="../../lib/gwt-util-1.0.0-jvm6.jar" />
        <library jar="../../lib/json-1.0.0-jvm6.jar" />
        <library jar="../../lib/mapper-1.0.0-jvm6.jar" />
        <library jar="../../lib/model-1.0.0-jvm6.jar" />
        <library jar="../../lib/projectional-1.0.0-jvm6.jar" />
        <library jar="../../lib/test-1.0.0-jvm6.jar" />
        <library jar="../../lib/values-1.0.0-jvm6.jar" />
        <library jar="../../lib/view-1.0.0-jvm6.jar" />
        <classpath>
          <entry path="." />
        </classpath>
        <sources jar="jetbrains.jetpad-src.jar" descriptor="jetbrains.jetpad.msd" />
      </module>
    </echoxml>
    <jar destfile="${build.layout}/jetpad/languages/jetpad/jetbrains.jetpad.jar" duplicate="preserve">
      <fileset dir="${mps_home}/plugins/jetpad/solutions/jetbrains.jetpad" includes="icons/**, resources/**" />
      <fileset dir="${build.tmp}/default/jetbrains.jetpad.jar" />
    </jar>
    <jar destfile="${build.layout}/jetpad/languages/jetpad/jetbrains.jetpad-src.jar" duplicate="preserve">
      <zipfileset file="${mps_home}/plugins/jetpad/solutions/jetbrains.jetpad/jetbrains.jetpad.msd" prefix="module" />
    </jar>
    <mkdir dir="${build.layout}/jetpad/lib" />
    <copy todir="${build.layout}/jetpad/lib">
      <fileset dir="${mps_home}/plugins/jetpad/lib" />
    </copy>
    <echo file="${build.layout}/build.properties">mpsBootstrapCore.version=${mpsBootstrapCore.version}</echo>
  </target>
  
  <target name="buildDependents">
    <ant antfile="build/mpsBootstrapCore.xml" inheritAll="false" useNativeBasedir="true" />
    <ant antfile="build/mpsCore.xml" inheritAll="false" useNativeBasedir="true" />
  </target>
  
  <target name="fetchDependencies" />
  
  <target name="build" depends="assemble" />
  
  <target name="clean">
    <delete dir="${build.tmp}" />
    <delete dir="${build.layout}" />
  </target>
  
  <target name="compileJava" />
  
  <target name="processResources" />
  
  <target name="classes" depends="compileJava, processResources" />
  
  <target name="test" depends="classes" />
  
  <target name="check" depends="test" />
  
  <target name="generate" depends="declare-mps-tasks, fetchDependencies">
    <echo message="generating" />
    <generate strictMode="true" parallelMode="true" parallelThreads="8" useInplaceTransform="false" hideWarnings="false" createStaticRefs="true" fork="true">
      <plugin path="${artifacts.mpsCore}/mps-core/META-INF/plugin.xml/../.." />
      <library file="${artifacts.mpsBootstrapCore}/lib/mps-core.jar" />
      <library file="${artifacts.mpsBootstrapCore}/lib/mps-editor.jar" />
      <library file="${artifacts.mpsBootstrapCore}/lib/mps-openapi.jar" />
      <library file="${artifacts.mpsBootstrapCore}/lib/mps-platform.jar" />
      <chunk>
        <module file="${mps_home}/plugins/jetpad/solutions/jetbrains.jetpad/jetbrains.jetpad.msd" />
      </chunk>
      <jvmargs>
        <arg value="-Xmx512m" />
      </jvmargs>
      <macro name="idea_home" path="${idea_home}" />
      <macro name="mps_home" path="${mps_home}" />
    </generate>
  </target>
  
  <target name="declare-mps-tasks">
    <taskdef resource="jetbrains/mps/build/ant/antlib.xml" classpathref="path.mps.ant.path" />
  </target>
  
  <target name="makeDependents">
    <ant antfile="build/mpsBootstrapCore.xml" inheritAll="false" useNativeBasedir="true">
      <target name="generate" />
      <target name="assemble" />
    </ant>
    <ant antfile="build/mpsCore.xml" inheritAll="false" useNativeBasedir="true">
      <target name="generate" />
      <target name="assemble" />
    </ant>
  </target>
  
  <target name="cleanSources" />
</project>
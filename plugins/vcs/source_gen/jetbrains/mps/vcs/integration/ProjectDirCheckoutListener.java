package jetbrains.mps.vcs.integration;

/*Generated by MPS */

import com.intellij.openapi.vcs.checkout.CheckoutListener;
import com.intellij.openapi.project.Project;
import java.io.File;
import com.intellij.openapi.ui.Messages;
import com.intellij.ide.impl.ProjectUtil;
import com.intellij.platform.ProjectBaseDirectory;

public class ProjectDirCheckoutListener implements CheckoutListener {
  @Override
  public boolean processCheckedOutDirectory(Project project, File directory) {
    // todo Rider project layout - several.idea.solution-name names 
    if (!(new File(directory, Project.DIRECTORY_STORE_FOLDER).exists())) {
      return false;
    }
    int rc = Messages.showYesNoDialog(project, "You have checked out an MPS project directory:\n" + directory.getPath() + "\nWould you like to open it?", "Checkout from Version Control", Messages.getQuestionIcon());

    if (rc == Messages.YES) {
      Project openedProject = ProjectUtil.openProject(directory.getPath(), project, false);
      if (openedProject != null) {
        ProjectBaseDirectory.getInstance(openedProject).setBaseDir(openedProject.getBaseDir());
      }
    }
    return true;
  }
  @Override
  public void processOpenedProject(Project lastOpenedProject) {
  }
}

package jetbrains.mps.lang.test.runtime;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import junit.framework.Assert;
import jetbrains.mps.lang.test.matcher.NodesMatcher;
import jetbrains.mps.errors.item.NodeReportItem;
import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.mps.errors.item.RuleIdFlavouredItem;

public class NodeCheckerUtil {

  public static String nodeWithIdToString(final SNode node) {
    return node + " [" + node.getNodeId() + "]";
  }

  public static void assertTypesAreTheSame(SNode node, final SNode type1, final SNode type2) {
    Assert.assertTrue(String.format("node '%s' doesn't have type '%s'!", nodeWithIdToString(node), nodeWithIdToString(type2)), new NodesMatcher(type1, type2).diff().isEmpty());
  }

  public static SNode getRuleNodeFromReporter(NodeReportItem reporter, SRepository contextRepository) {
    if (RuleIdFlavouredItem.FLAVOUR_RULE_ID.getCollection(reporter).isEmpty() || contextRepository == null) {
      return null;
    }
    return RuleIdFlavouredItem.FLAVOUR_RULE_ID.getCollection(reporter).iterator().next().getSourceNode().resolve(contextRepository);
  }

  public static void checkNodeForErrorMessages(final SNode node, final boolean allowErrors, final boolean allowWarnings, boolean includeSelf) {
    Runnable checkErrorsAction = new CheckErrorMessagesAction(node, allowWarnings, allowErrors).includeSelf(includeSelf);
    checkErrorsAction.run();
  }
}

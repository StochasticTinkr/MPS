package jetbrains.mps.baseLanguage.unitTest.execution.tool;

/*Generated by MPS */

import com.intellij.icons.AllIcons;
import org.jetbrains.annotations.Nullable;
import javax.swing.Icon;
import org.jetbrains.annotations.NotNull;

public enum TestState {
  NOT_RAN(AllIcons.RunConfigurations.TestNotRan, false, false),
  IN_PROGRESS(null, false, false),
  PASSED(AllIcons.RunConfigurations.TestPassed, true, false),
  IGNORED(AllIcons.RunConfigurations.TestIgnored, true, false),
  SKIPPED(AllIcons.RunConfigurations.TestSkipped, true, true),
  ASSUMPTION_FAILED(AllIcons.RunConfigurations.TestSkipped, true, true),
  FAILED(AllIcons.RunConfigurations.TestFailed, true, true),
  ERROR(AllIcons.RunConfigurations.TestError, true, true),
  TERMINATED(AllIcons.RunConfigurations.TestTerminated, true, true);


  @Nullable
  private final Icon myIcon;
  private final boolean myFinished;
  private final boolean myErrored;

  private static final int FRAMES_COUNT = 8;
  private static final int MOVIE_TIME = 800;
  /*package*/ static final int FRAME_TIME = MOVIE_TIME / FRAMES_COUNT;
  private static final Icon[] FRAMES = new Icon[FRAMES_COUNT];

  TestState(Icon icon, boolean finished, boolean isError) {
    myIcon = icon;
    myFinished = finished;
    myErrored = isError;
  }

  public Icon getIcon() {
    if (this == TestState.IN_PROGRESS) {
      return getCurrentFrameIcon();
    }
    return myIcon;
  }

  public boolean isAnimated() {
    return this == TestState.IN_PROGRESS;
  }

  public boolean isFinished() {
    return myFinished;
  }

  public boolean isErrored() {
    return myErrored;
  }

  @NotNull
  private static Icon getCurrentFrameIcon() {
    final int index = (int) ((System.currentTimeMillis() % MOVIE_TIME) / FRAME_TIME);
    return FRAMES[index];
  }

  static {
    FRAMES[0] = AllIcons.RunConfigurations.TestInProgress1;
    FRAMES[1] = AllIcons.RunConfigurations.TestInProgress2;
    FRAMES[2] = AllIcons.RunConfigurations.TestInProgress3;
    FRAMES[3] = AllIcons.RunConfigurations.TestInProgress4;
    FRAMES[4] = AllIcons.RunConfigurations.TestInProgress5;
    FRAMES[5] = AllIcons.RunConfigurations.TestInProgress6;
    FRAMES[6] = AllIcons.RunConfigurations.TestInProgress7;
    FRAMES[7] = AllIcons.RunConfigurations.TestInProgress8;
  }
}

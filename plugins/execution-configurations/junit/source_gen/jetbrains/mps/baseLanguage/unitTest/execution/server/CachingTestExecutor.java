package jetbrains.mps.baseLanguage.unitTest.execution.server;

/*Generated by MPS */

import jetbrains.mps.util.test.CachesUtil;
import java.io.IOException;
import jetbrains.mps.tool.environment.Environment;
import jetbrains.mps.tool.environment.IdeaEnvironment;
import jetbrains.mps.tool.environment.EnvironmentConfig;

public class CachingTestExecutor extends DefaultTestExecutor {
  public CachingTestExecutor(TestsContributor testsContributor) {
    super(testsContributor);
  }

  @Override
  public void init() {
    CachesUtil.setupCaches();
    super.init();
  }

  /**
   * Called when ITestCase is executed (except for BTestCase)
   */
  public static void main(String[] args) throws IOException {
    Environment env = IdeaEnvironment.getOrCreate(EnvironmentConfig.defaultConfigNoPluginsSpecified());
    CachingTestExecutor executor = new CachingTestExecutor(new CommandLineTestsContributor(env, args));
    try {
      executor.run();
    } catch (Throwable t) {
      executor.processThrowable(t);
    }
    executor.exit();
    env.dispose();
  }

  @Override
  protected void processThrowable(Throwable t) {
    CachesUtil.cleanupCaches();
    super.processThrowable(t);
  }
}

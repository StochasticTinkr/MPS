package jetbrains.mps.baseLanguage.unitTest.execution.tool;

/*Generated by MPS */

import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.TreeSelectionModel;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.tree.TreePath;
import jetbrains.mps.baseLanguage.unitTest.execution.TestNodeKey;
import jetbrains.mps.baseLanguage.unitTest.execution.TestNodeKeyFactory;

public class TestTreeSelectionListener implements TreeSelectionListener {
  private final TreeSelectionModel myFreeSelectionModel;
  private final StatisticsTableModel myStatisticsModel;
  private final TestOutputComponent myOutputComponent;

  public TestTreeSelectionListener(TestTree tree, StatisticsTableModel statistics, TestOutputComponent outputComponent) {
    myFreeSelectionModel = tree.getSelectionModel();
    myStatisticsModel = statistics;
    myOutputComponent = outputComponent;
  }

  @Override
  public void valueChanged(TreeSelectionEvent event) {
    if (event.getNewLeadSelectionPath() == null) {
      return;
    }
    TreePath path = myFreeSelectionModel.getSelectionPath();
    if (path == null) {
      return;
    }
    TestNodeKey newKey = null;
    Object obj = path.getLastPathComponent();
    if (obj instanceof NonRootTestTreeNode) {
      NonRootTestTreeNode treeNode = (NonRootTestTreeNode) obj;
      newKey = TestNodeKeyFactory.wrap(treeNode.getTestNode());
    }
    myOutputComponent.setFilter(newKey);
    myStatisticsModel.setFilter(newKey);
  }
}

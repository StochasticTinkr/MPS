package jetbrains.mps.ide.httpsupport.manager.plugin;

/*Generated by MPS */

import org.jetbrains.annotations.NotNull;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.Objects;

public abstract class HttpRequestHandlerBase implements IHttpRequestHandler {

  protected HttpRequest request;

  @NotNull
  @Override
  public String getName() {
    return getClass().getSimpleName();
  }

  @Override
  public boolean isTrustful() {
    return false;
  }

  @Override
  public boolean canHandle(@NotNull HttpRequest request) {
    init(request);

    return checkQueryPrefix();
  }


  @Override
  public void handle(@NotNull HttpRequest request) throws Exception {
    init(request);
  }

  private void init(@NotNull HttpRequest request) {
    if (this.request == request) {
      return;
    }

    this.request = request;
    initParameterValues();
  }

  protected boolean checkQueryPrefix() {
    List<String> queryPrefixSegments = HttpRequest.getSegmentsFor(getQueryPrefix());
    List<String> queryPathSegments = request.getSegments();
    if (ListSequence.fromList(queryPathSegments).count() < ListSequence.fromList(queryPrefixSegments).count()) {
      return false;
    }
    for (int i = 0; i < ListSequence.fromList(queryPrefixSegments).count(); i++) {
      if (!(Objects.equals(ListSequence.fromList(queryPathSegments).getElement(i), ListSequence.fromList(queryPrefixSegments).getElement(i)))) {
        return false;
      }
    }
    return true;
  }

  protected abstract void initParameterValues();
  protected abstract String getQueryPrefix();
}

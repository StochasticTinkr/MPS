package jetbrains.mps.nodeEditor.cells.jetpad;

/*Generated by MPS */

import jetbrains.jetpad.model.property.Property;
import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.jetpad.model.event.EventHandler;
import jetbrains.jetpad.model.property.PropertyChangeEvent;
import jetbrains.mps.smodel.UndoRunnable;

public abstract class WritableModelProperty<T> extends ReadableModelProperty<T> implements Property<T> {
  private final String myCommandId;
  private final SRepository myRepo;

  public WritableModelProperty(String commandId, SRepository repository) {
    myCommandId = commandId;
    myRepo = repository;
    addHandler(new EventHandler<PropertyChangeEvent<T>>() {
      public void onEvent(PropertyChangeEvent<T> event) {
        safeSetModelPropertyValue(event.getNewValue());
      }
    });
  }
  protected void safeSetModelPropertyValue(final T t) {
    myRepo.getModelAccess().executeCommand(new UndoRunnable.Base(null, myCommandId) {
      public void run() {
        setModelPropertyValue(t);
      }
    });
  }
  protected abstract void setModelPropertyValue(T value);
}

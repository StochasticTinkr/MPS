package jetbrains.mps.ide.modelchecker.platform.actions;

/*Generated by MPS */

import jetbrains.mps.checkers.IRootChecker;
import jetbrains.mps.checkers.IChecker;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.errors.item.NodeReportItem;
import jetbrains.mps.checkers.IAbstractChecker;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.checkers.IteratingChecker;
import jetbrains.mps.checkers.CategoryShowingChecker;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import org.jetbrains.mps.openapi.module.SRepository;
import org.jetbrains.mps.openapi.util.Consumer;
import jetbrains.mps.errors.item.IssueKindReportItem;
import org.jetbrains.mps.openapi.util.ProgressMonitor;

public class RootCheckerSpecificCheckerAdapter {
  private final IRootChecker myChecker;
  private final String myCategory;

  public RootCheckerSpecificCheckerAdapter(IRootChecker checker, String category) {
    myChecker = checker;
    myCategory = category;
  }

  public static IChecker<SModel, NodeReportItem> createNew(IAbstractChecker<SNode, NodeReportItem> checker, String category) {
    return new IteratingChecker<SModel, SNode, NodeReportItem>(new CategoryShowingChecker.CategoryWrapper<SNode, NodeReportItem>(checker, category), new _FunctionTypes._return_P1_E0<IteratingChecker.CollectionIteratorWithProgress<SNode>, SModel>() {
      public IteratingChecker.CollectionIteratorWithProgress<SNode> invoke(SModel model) {
        return new IteratingChecker.CollectionIteratorWithProgress<SNode>(SModelOperations.roots(model, null));
      }
    });
  }

  public void check(SModel model, SRepository repository, final Consumer<? super IssueKindReportItem> errorCollector, final ProgressMonitor monitor) {
    monitor.start(myCategory, 1);
    for (final SNode rootNode : SModelOperations.roots(model, null)) {
      myChecker.check(rootNode, repository, errorCollector, monitor);
    }
    monitor.done();
  }

}

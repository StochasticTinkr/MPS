package jetbrains.mps.lang.editor.menus.contextAssistant.tests;

/*Generated by MPS */

import jetbrains.mps.MPSLaunch;
import jetbrains.mps.lang.test.runtime.BaseTransformationTest;
import org.junit.Test;
import jetbrains.mps.lang.test.runtime.BaseEditorTestBody;
import jetbrains.mps.openapi.editor.update.UpdaterListenerAdapter;
import jetbrains.mps.openapi.editor.EditorComponent;
import java.util.Set;
import jetbrains.mps.nodeEditor.EditorCell_WithComponent;
import junit.framework.Assert;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import javax.swing.SwingUtilities;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;

@MPSLaunch
public class ContextAssistant_InitiallyExpandedVisibility_Test extends BaseTransformationTest {
  @Test
  public void test_ContextAssistant_InitiallyExpandedVisibility() throws Throwable {
    initTest("${mps_home}", "r:5a4d10fc-2567-46c5-982f-547e9102417b(jetbrains.mps.lang.editor.menus.contextAssistant.tests@tests)");
    runTest("jetbrains.mps.lang.editor.menus.contextAssistant.tests.ContextAssistant_InitiallyExpandedVisibility_Test$TestBody", "testMethod", false);
  }

  @MPSLaunch
  public static class TestBody extends BaseEditorTestBody {
    @Override
    public void testMethodImpl() throws Exception {
      initEditorComponent("379023083996699953", "");
      getEditorComponent().getUpdater().addListener(new UpdaterListenerAdapter() {
        @Override
        public void editorUpdated(EditorComponent editorComponent) {
          Set<EditorCell_WithComponent> componentCells = getEditorComponent().getCellTracker().getComponentCells();
          Assert.assertFalse(componentCells.isEmpty());
          for (EditorCell_WithComponent cell : SetSequence.fromSet(componentCells)) {
            Assert.assertFalse(cell.getComponent().isVisible());
          }
        }
      });
      SwingUtilities.invokeAndWait(new Runnable() {
        public void run() {
          getEditorComponent().getEditorContext().getContextAssistantManager().updateImmediately();
        }
      });
      pressKeys(ListSequence.fromListAndArray(new ArrayList<String>(), " F5"));
      SwingUtilities.invokeAndWait(new Runnable() {
        public void run() {
          getEditorComponent().getEditorContext().getContextAssistantManager().updateImmediately();
          Set<EditorCell_WithComponent> componentCells = getEditorComponent().getCellTracker().getComponentCells();
          Assert.assertFalse(componentCells.isEmpty());
          for (EditorCell_WithComponent cell : SetSequence.fromSet(componentCells)) {
            Assert.assertTrue(cell.getComponent().isVisible());
          }
        }
      });

    }
  }
}

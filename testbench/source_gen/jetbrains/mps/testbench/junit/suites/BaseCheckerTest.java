package jetbrains.mps.testbench.junit.suites;

/*Generated by MPS */

import org.jetbrains.mps.openapi.module.SModule;
import java.util.List;
import jetbrains.mps.checkers.IChecker;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.errors.item.NodeReportItem;
import jetbrains.mps.testbench.PerformanceMessenger;
import jetbrains.mps.smodel.ModelAccessHelper;
import jetbrains.mps.util.Computable;
import jetbrains.mps.checkers.ModelCheckerBuilder;
import org.junit.Assert;

public abstract class BaseCheckerTest extends BaseCheckModulesTest {

  public BaseCheckerTest(SModule module) {
    super(module);
  }

  public void runCheck(final List<IChecker<SNode, NodeReportItem>> checkers, PerformanceMessenger stats, String errorMessage) {
    final CheckingTestStatistic statistic = new CheckingTestStatistic();
    List<String> errors = new ModelAccessHelper(BaseCheckModulesTest.getContextProject().getModelAccess()).runReadAction(new Computable<List<String>>() {
      public List<String> compute() {
        return new CheckingTestsUtil(statistic).applyChecker(myModule, new ModelCheckerBuilder.ModelsExtractorImpl().excludeGenerators(), checkers);
      }
    });

    stats.report("Errors", statistic.getNumErrors());
    stats.report("Warnings", statistic.getNumWarnings());
    Assert.assertTrue(errorMessage + ":\n" + CheckingTestsUtil.formatErrors(errors), errors.isEmpty());
  }
}

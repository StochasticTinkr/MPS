package jetbrains.mps.testbench.junit.runners;

/*Generated by MPS */

import java.util.List;
import java.util.Arrays;
import java.util.function.Function;
import jetbrains.mps.vfs.IFile;
import jetbrains.mps.vfs.impl.IoFileSystem;
import java.util.function.Predicate;
import java.util.stream.Collectors;
import com.intellij.openapi.vfs.newvfs.impl.VfsRootAccess;

/**
 * deals with the VfsRootAccess checks in tests
 */
public class TestRootAccessInsight {
  /**
   * here we use parent directories because of *.jar + *-src.jar layout
   * we don't get latter in the 'modules' argument
   */
  public static void allowTestRootAccessForModuleFolders(final String[] modules) {
    List<String> moduleFolders = Arrays.stream(modules).map(new Function<String, String>() {
      @Override
      public String apply(String module) {
        IFile file = IoFileSystem.INSTANCE.getFile(module);
        IFile parent = file.getParent();
        if (parent == null) {
          return null;
        }
        return parent.getPath();
      }
    }).filter(new Predicate<String>() {
      public boolean test(String file) {
        return file != null;
      }
    }).collect(Collectors.toList());
    VfsRootAccess.allowRootAccess(moduleFolders.toArray(new String[moduleFolders.size()]));
  }

}

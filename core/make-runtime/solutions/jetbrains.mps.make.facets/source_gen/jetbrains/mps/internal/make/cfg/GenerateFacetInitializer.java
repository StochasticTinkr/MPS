package jetbrains.mps.internal.make.cfg;

/*Generated by MPS */

import jetbrains.mps.make.script.PropertyPoolInitializer;
import jetbrains.mps.generator.GenerationOptions;
import jetbrains.mps.util.annotation.ToRemove;
import jetbrains.mps.make.script.IPropertiesPool;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import jetbrains.mps.make.facet.ITarget;

/**
 * Single facility that knows which properties of Generate facet to initialize.
 * Now takes all the values from MakeSession, but may get additional methods to set
 * values explicitly (e.g. cleanMake for those longing for rebuild only).
 * Perhaps, this it should be MakeSession's responsibility to set properties.
 */
public final class GenerateFacetInitializer implements PropertyPoolInitializer {
  private GenerationOptions.OptionsBuilder myGenOptions;

  public GenerateFacetInitializer() {
  }

  /**
   * Override clean make argument from MakeSession. 
   * FIXME Theres's only 1 use, in BuildMakeService, likely we can get rid of it, and always use value from MakeSession
   * 
   * @deprecated no-op, do not use
   * @param cleanMake true to force complete generation
   * @return <code>this</code> for convenience
   */
  @Deprecated
  @ToRemove(version = 2017.3)
  public GenerateFacetInitializer cleanMake(boolean cleanMake) {
    return this;
  }
  public GenerateFacetInitializer setGenerationOptions(GenerationOptions.OptionsBuilder optionsBuilder) {
    myGenOptions = optionsBuilder;
    return this;
  }

  @Override
  public void populate(IPropertiesPool ppool) {
    if (myGenOptions != null) {
      Tuples._2<Boolean, GenerationOptions.OptionsBuilder> params = (Tuples._2<Boolean, GenerationOptions.OptionsBuilder>) ppool.properties(new ITarget.Name("jetbrains.mps.lang.core.Generate.configure"), Object.class);
      if (params != null) {
        params._1(myGenOptions);
      }
    }
  }
}

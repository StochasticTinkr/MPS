package jetbrains.mps.build.ant;

/*Generated by MPS */

import java.util.Set;
import java.io.File;
import java.util.List;
import org.apache.tools.ant.BuildException;
import java.util.LinkedHashSet;

public class CustomMPSLoadTask extends MpsLoadTask {
  private String myWorkerClass;
  private String myArgs;

  public void setWorker(String workerClass) {
    myWorkerClass = workerClass;
  }

  public void setArgs(String args) {
    myArgs = args;
  }

  protected String getWorkerClass() {
    return myWorkerClass;
  }

  @Override
  protected String getAdditionalArgs() {
    return myArgs;
  }

  @Override
  protected Set<File> calculateClassPath(boolean fork) {
    List<File> classPathRoots = MPSClasspathUtil.getClassPathRootsFromDependencies(getProject());
    if (classPathRoots.isEmpty()) {
      throw new BuildException("Dependency on MPS build scripts is required to generate MPS modules.");

    }
    Set<File> classPath = new LinkedHashSet<File>();
    for (File file : classPathRoots) {
      MPSClasspathUtil.gatherAllClassesAndJarsUnder(file, classPath);
    }

    return classPath;
  }
}

<project name="mpsConnectorPlugin" default="build" basedir="../">
  <!-- Generated by MPS -->
  <property name="build.dir" location="build" />
  <property name="build.tmp" location="${build.dir}/tmp/mpsConnectorPlugin" />
  <property name="build.layout" location="${build.dir}/artifacts/mpsConnectorPlugin" />
  <property name="idea_home" location="" />
  <property name="mps_home" location="${basedir}" />
  <property name="environment" value="env" />
  <property name="env.JAVA_HOME" value="${java.home}/.." />
  <property name="jdk.home" value="${env.JAVA_HOME}" />
  
  <path id="path.javac2.classpath">
    <fileset dir="${idea_home}/lib">
      <include name="javac2.jar" />
      <include name="jdom.jar" />
      <include name="asm4-all.jar" />
      <include name="asm-all.jar" />
      <include name="jgoodies-forms.jar" />
    </fileset>
  </path>
  
  <path id="path.jdk.classpath">
    <pathelement path="${jdk.home}/Classes/classes.jar" />
    <pathelement path="${jdk.home}/lib/tools.jar" />
    <fileset dir="${jdk.home}">
      <include name="jre/lib/*.jar" />
    </fileset>
  </path>
  
  <path id="path.java.library.idea-jars">
    <fileset dir="${idea_home}/lib">
      <include name="**/*.jar" />
      <exclude name="boot.jar" />
    </fileset>
  </path>
  
  <taskdef name="javac2" classname="com.intellij.ant.Javac2" classpathref="path.javac2.classpath" />
  
  <target name="assemble" depends="classes">
    <mkdir dir="${build.layout}/plugin" />
    <jar destfile="${build.layout}/plugin/MPSPlugin.jar" duplicate="preserve">
      <fileset dir="${build.tmp}/java/out/MPS-plugin" />
    </jar>
  </target>
  
  <target name="buildDependents" />
  
  <target name="fetchDependencies" />
  
  <target name="build" depends="assemble" />
  
  <target name="clean">
    <delete dir="${build.tmp}" />
    <delete dir="${build.layout}" />
  </target>
  
  <target name="compileJava" depends="java.compile.MPS-plugin" />
  
  <target name="processResources" />
  
  <target name="classes" depends="compileJava, processResources" />
  
  <target name="test" depends="classes" />
  
  <target name="check" depends="test" />
  
  <target name="java.compile.MPS-plugin">
    <mkdir dir="${mps_home}/MPSPlugin/source" />
    <mkdir dir="${mps_home}/MPSPlugin/source-api" />
    <mkdir dir="${build.tmp}/java/out/MPS-plugin" />
    <javac2 destdir="${build.tmp}/java/out/MPS-plugin" fork="false" encoding="utf8" includeantruntime="false" debug="true">
      <compilerarg value="-Xlint:none" />
      <src>
        <path location="${mps_home}/MPSPlugin/source" />
        <path location="${mps_home}/MPSPlugin/source-api" />
      </src>
      <classpath>
        <path refid="path.java.library.idea-jars" />
        <path refid="path.jdk.classpath" />
      </classpath>
    </javac2>
    <copy todir="${build.tmp}/java/out/MPS-plugin">
      <fileset dir="${mps_home}/MPSPlugin">
        <include name="META-INF/**" />
      </fileset>
      <fileset dir="${mps_home}/MPSPlugin/source" includes="**/*.properties, **/*.xml, **/*.html, **/*.png, **/*.txt, **/*.ico, **/*.zip, **/*.info" />
      <fileset dir="${mps_home}/MPSPlugin/source-api" includes="**/*.properties, **/*.xml, **/*.html, **/*.png, **/*.txt, **/*.ico, **/*.zip, **/*.info" />
    </copy>
  </target>
</project>
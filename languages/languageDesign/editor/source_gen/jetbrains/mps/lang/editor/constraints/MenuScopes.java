package jetbrains.mps.lang.editor.constraints;

/*Generated by MPS */

import jetbrains.mps.scope.Scope;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.scope.ModelPlusImportedScope;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.scope.EmptyScope;
import jetbrains.mps.scope.FilteringScope;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;

public class MenuScopes {
  public static Scope getNamedMenus(SNode contextNode, String contextRole, int position) {
    final Scope allNamedMenus = new ModelPlusImportedScope(SNodeOperations.getModel(contextNode), true, MetaAdapterFactory.getConcept(0x18bc659203a64e29L, 0xa83a7ff23bde13baL, 0x4e0f93d8a0ac4ee8L, "jetbrains.mps.lang.editor.structure.TransformationMenu_Named"));

    // Uses the scope of allowed concepts (for default menus) to restrict the set of named menus to those 
    // that reference allowed concepts. 
    final Scope allowedConcepts = Scope.getScope(contextNode, contextRole, position, MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, "jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration").getDeclarationNode());
    if (allowedConcepts == null) {
      return new EmptyScope();
    }

    return new FilteringScope(allNamedMenus) {
      @Override
      public boolean isExcluded(SNode node) {
        return !(allowedConcepts.contains(SLinkOperations.getTarget(SNodeOperations.cast(node, MetaAdapterFactory.getConcept(0x18bc659203a64e29L, 0xa83a7ff23bde13baL, 0x4e0f93d8a0ac4ee8L, "jetbrains.mps.lang.editor.structure.TransformationMenu_Named")), MetaAdapterFactory.getReferenceLink(0x18bc659203a64e29L, 0xa83a7ff23bde13baL, 0x4e0f93d8a0ac3ebaL, 0x162bf82611ed9b28L, "conceptDeclaration"))));
      }
    };
  }
}
